<!-- Estoy re-aprendiendo PrimeNG por que esta bonito -->
<p-card header="Panel de Control">
  <div class="mb-4">
    <h3 class="text-xl font-semibold mb-3">Configuraci贸n del ESP32</h3>
    <div class="flex gap-3 items-end mb-4">
      <div class="flex-1">
        <label for="esp32-ip" class="block mb-2 font-medium">Direcci贸n IP del ESP32:</label>
        <input
          id="esp32-ip"
          type="text"
          pInputText
          [(ngModel)]="esp32IpInput"
          placeholder="Ej: 192.168.0.54"
          class="w-full" />
      </div>
      <p-button
        label="Actualizar IP"
        icon="pi pi-refresh"
        (click)="updateEsp32Ip()"
        severity="info" />
    </div>
  </div>

  <div class="mb-4">
    <h3 class="text-xl font-semibold mb-3">Estado del Dispensador</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div>
        <p class="mb-2"><strong>Estado de Llenado:</strong> {{ fullnessStatus }}</p>
        <p><strong>Porcentaje de Llenado:</strong> {{ fullnessPercentage }}%</p>
      </div>
      <div class="flex items-center justify-end">
        <p-button
          label="Rellenar Plato"
          icon="pi pi-replay"
          severity="success"
          (click)="refillDispenser()"
          [loading]="isRefilling" />
      </div>
    </div>
  </div>
</p-card>

<p-card header="Historial de Solicitudes" class="mt-4">
  <p-table
    [value]="requestHistory"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} solicitudes">
    <ng-template #header>
      <tr>
        <th>Hora</th>
        <th>Estado</th>
        <th>Acci贸n</th>
      </tr>
    </ng-template>
    <ng-template #body let-request>
      <tr>
        <td>{{ request.hora | date:'short' }}</td>
        <td>@switch (request.estado) {
            @case ("Completed") {
              <p-tag severity="success" value="Completado"></p-tag>
            }
            @case ("Cancelled") {
              <p-tag severity="danger" value="Cancelado"></p-tag>
            }
            @case ("Pending") {
              <p-tag severity="info" value="Pendiente"></p-tag>
            }
          }
        </td>
        @if (request.estado == "Pending") {
          <td class="text-center">
            <div class="flex justify-center gap-2">
              <p-button icon="pi pi-check" severity="success" (click)="completeRequest(request)" label="Aceptar" />
              <p-button icon="pi pi-times" severity="danger" (click)="cancelRequest(request)" label="Rechazar" />
            </div>
          </td>
        } @else {
          <td class="text-center">
            <p-tag severity="secondary" value="No se requiere acci贸n"></p-tag>
          </td>
        }
      </tr>
    </ng-template>
  </p-table>
</p-card>

